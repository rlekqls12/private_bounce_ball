<html>
	<head>
		<title> Bounce Ball </title>
		<script>
			var crtX = 30, crtY = 50, spd = 5, jmp = 0, grt = 0, getKey, goLR = 0, hitV, life = 3, playing = 0, game, death, crt,
			walls = new Array(new Array(null, 0, 500, 500));
			const crtR = 15, roundW = 1500;
			window.onload = function() {
				document.body.scrollLeft = 0;

				game = document.createElement('div');

				drawWalls();

				function drawWalls() {
					for (var i = 0; i < walls.length; i++) {
						walls[i][0] =  document.createElement('img');
						walls[i][0].src = '';
						walls[i][0].width = walls[i][3];
						walls[i][0].height = 150;
						walls[i][0].setAttribute('style', 'background: #fff url(wall.png);');
						walls[i][0].style.position = "absolute";
						walls[i][0].style.left = walls[i][1] + 'px';
						walls[i][0].style.top = walls[i][2] + 'px';
						game.appendChild(walls[i][0]);
					}
				}

				crt = document.createElement('img');
				crt.src = 'ball.png';
				crt.width = crt.height = crtR;
				crt.style.position = "absolute";
				draw();
				game.appendChild(crt);

				document.body.appendChild(game);

				function draw() {
					crt.style.left = crtX + 'px';
					crt.style.top = crtY + 'px';
				}

				function move() {
					if (playing == 0) {
						if (goLR == 1) {
							crtX -= spd;
						} else if (goLR == 2) {
							crtX += spd;
						}
						if (crtX < 0) {
							crtX = 0;
						} else if (crtX > roundW - 15) {
							crtX = roundW - 15;
						}
						if (crtX - document.body.scrollLeft >= 392.5) {
							document.body.scrollLeft = crtX - 392.5;
						} else if (crtX - document.body.scrollLeft < 392.5) {
							document.body.scrollLeft = crtX - 392.5;
						}
					}
				}

				function gameOver() {
					if (life > 0) {
						playing = 1;
						goLR = 0;
						crtX = 30;
						crtY = 50;
						death = document.createElement('div');
						death.innerHTML = '<center><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><font color="white" size="24">Life : ' + (--life) + '</font></center>';
						game.setAttribute('style', 'visibility: hidden;');
						document.body.appendChild(death);
						document.body.scrollLeft = 0;
						setTimeout(function() {
							document.body.removeChild(death);
							game.setAttribute('style', 'visibility: visible;');
							playing = 0;
						}, 2000);
					}
				}

				function hitTest(ori, tar) {
					var oriX, oriY, oriW, oriH, tarX, tarY, tarW, tarH, valTB = 0, valLR = 0;
					oriX = Number((ori.style.left).replace('px',''));
					oriY = Number((ori.style.top).replace('px',''));
					oriW = ori.width;
					oriH = ori.height;
					tarX = Number((tar.style.left).replace('px',''));
					tarY = Number((tar.style.top).replace('px',''));
					tarW = tar.width;
					tarH = tar.height;

					if ((oriY >= tarY && oriY <= tarY + tarH) || (oriY + oriH >= tarY && oriY + oriH <= tarY + tarH)) {
						if (oriX + oriW >= tarX && oriX + oriW <= tarX + (tarW / 2))
							valLR = 1;
						else if (oriX >= tarX + (tarW / 2) && oriX <= tarX + tarW)
							valLR = 2;
					}
					if ((oriX >= tarX && oriX <= tarX + tarW) || (oriX + oriW >= tarX && oriX + oriW <= tarX + tarW)) {
						if (oriY + oriH >= tarY && oriY + oriH <= tarY + (tarH / 2))
							valTB = 1;
						else if (oriY >= tarY + (tarH / 2) && oriY <= tarY + tarH)
							valTB = 2;
					}
					return valLR + "/" + valTB;
				}

				function hitChk() {
					if (playing == 0) {
						for (var i = 0; i < walls.length; i++) {
							hitV = hitTest(crt, walls[i][0]);
							if (hitV.split("/")[1] == 1) {
								crtY = walls[i][2] - (crtR + 0.1);
								jmp = 1;
								grt = 0;
							}
						}
						if (jmp == 0) {
							crtY += 10 + grt;
							grt += 0.8;
						}
						if (jmp == 1) {
							crtY -= 10 - grt;
							grt += 0.8;
						}
						if (crtY >= 600) {
							gameOver();
						}//땅에 부딫히면 땅을 파고듬 hitTest 문제인거 같음
					}
				}

				function getKeyValue() {
					getKey = event.keyCode;
					if (playing == 0) {
						if (getKey == "65") {
							goLR = 1;
						} else if (getKey == "68") {
							goLR = 2;
						} else if (getKey == "83") {
							goLR = 0;
						}
					}
				}

				document.onkeydown = getKeyValue;

				setInterval(function() {
					move();
					draw();
					hitChk();
				}, 1000/3);
			}
		</script>
	</head>
	<body bgcolor="black" oncontextmenu="return false" ondragstart="return false" onselectstart="return false">
		
	</body>
</html>